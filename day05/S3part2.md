# pre-signed URL

A **pre-signed URL** is a way to securely grant **temporary access** to a private object stored in cloud storage services like **Amazon S3** (or others). It is commonly used to allow **downloads (GET)** or **uploads (PUT/POST)** without making the object publicly accessible.

Let’s break it down in simple terms:

---

## 🔐 What is a Pre-Signed URL?

A **pre-signed URL** is a special **time-limited URL** that includes authentication information in the query string. It is generated by someone who has permission to access the object (usually your backend), and it allows someone else (like a frontend user or third-party app) to access the object **without needing credentials**.

---

## 📦 Use Case for GET (Download)

Suppose you store images, PDFs, or videos in a private S3 bucket. You don’t want to make them public, but you want to let a user download one. You:

1. Generate a **GET pre-signed URL** using your backend.
2. Send this URL to the client.
3. The client uses this URL to **download the file** securely within a time limit (e.g., 5 minutes).

---

## 🧠 How it Works

1. You generate a pre-signed URL on your **backend** using AWS SDK.

2. The URL contains:

   * The bucket and object key
   * The operation (`GET`)
   * An **expiry time**
   * A **signature** (based on your AWS credentials)

3. Anyone who has this URL can access the object **until it expires**.

---

## ✅ Benefits

* Keeps S3 objects private
* Provides time-limited access
* No need to expose AWS credentials
* Secure and temporary download links

---

## 🧑‍💻 Node.js Example (GET Pre-Signed URL)

Using AWS SDK v3:

```js
import { S3Client, GetObjectCommand } from "@aws-sdk/client-s3";
import { getSignedUrl } from "@aws-sdk/s3-request-presigner";

const s3Client = new S3Client({
  region: "ap-south-1",
  credentials: {
    accessKeyId: "YOUR_ACCESS_KEY",
    secretAccessKey: "YOUR_SECRET_KEY"
  }
});

async function generatePresignedUrl(bucketName, objectKey) {
  const command = new GetObjectCommand({
    Bucket: bucketName,
    Key: objectKey
  });

  // Expires in 5 minutes (300 seconds)
  const url = await getSignedUrl(s3Client, command, { expiresIn: 300 });

  console.log("Pre-signed GET URL:", url);
  return url;
}

// Usage
generatePresignedUrl("my-private-bucket", "images/report.pdf");
```

> 🔒 Anyone with this URL can now download `report.pdf` from your private bucket for the next 5 minutes.

---

## ⚠️ Security Notes

* Pre-signed URLs can **leak access** if shared or logged publicly.
* Set **short expiry times** to reduce risk.
* Use HTTP headers or signed URLs only from trusted sources.

---

## 🧪 When to Use

* Serving private images or documents
* Temporary access for authenticated users
* Letting clients download large files from S3 directly

---
---
---

## Examples

```
https://ayush-prvt-bkt.s3.ap-south-1.amazonaws.com/myimage.png
```

| Part                          | Meaning                                                                 |
| ----------------------------- | ----------------------------------------------------------------------- |
| `https://`                    | Protocol                                                                |
| `ayush-prvt-bkt`              | **Bucket name**                                                         |
| `s3.ap-south-1.amazonaws.com` | **S3 service endpoint** for region `ap-south-1` (Asia Pacific - Mumbai) |
| `/myimage.png`                | **Object key** (i.e., the path to the file inside the bucket)           |

---

### 🔑 Summary

* **Bucket Name**: `ayush-prvt-bkt`
* **Region**: `ap-south-1` (Mumbai)
* **Key (Object Name)**: `myimage.png`

if your object key has folders like `images/myimage.png` — then the key would include the full path.

---
---
---

## 🔍 1. The First Link (✅ **Working**)

```
https://ayush-prvt-bkt.s3.ap-south-1.amazonaws.com/myimage.png?
X-Amz-Algorithm=AWS4-HMAC-SHA256
&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD
&X-Amz-Credential=...
&X-Amz-Date=...
&X-Amz-Expires=300
&X-Amz-Security-Token=...
&X-Amz-Signature=...
&X-Amz-SignedHeaders=host
&response-content-disposition=inline
```

This is a **pre-signed URL**, which includes several query parameters that authorize the request. Here's what’s happening:

### ✅ Why It Works:

* **This object is private** (in your S3 bucket).
* The URL includes:

  * `X-Amz-Algorithm` – Tells AWS the signing algorithm used.
  * `X-Amz-Credential` – Temporarily authorized credentials (IAM role or user).
  * `X-Amz-Date` – When the URL was generated.
  * `X-Amz-Expires` – How long it's valid (e.g., 300 seconds = 5 mins).
  * `X-Amz-Signature` – A cryptographic signature proving this request was authorized.
  * `X-Amz-Security-Token` – Required when using temporary credentials (like from STS).
  * `response-content-disposition=inline` – Suggests browser display the file (not download it).

The signature validates:

* The user has access
* The URL hasn’t expired
* The file hasn't been tampered with

> ✅ **This is secure temporary access.**

---

## 🚫 2. The Second Link (❌ Not Working)

```
https://ayush-prvt-bkt.s3.ap-south-1.amazonaws.com/myimage.png
```

This is a **plain, unsigned** URL that points to the object directly, **without any authentication**.

### ❌ Why It Doesn't Work:

* Your **S3 bucket or object is private**, so:

  * It requires authentication.
  * AWS **rejects** the request because no signature/authorization is included.
* Only users with proper AWS credentials (via IAM, etc.) can access the object **without** a pre-signed URL.

---

## 🔐 Conclusion

| Link Type          | Requires Signature | Works for Private Objects? | Safe to Share?      | Time Limited? |
| ------------------ | ------------------ | -------------------------- | ------------------- | ------------- |
| **Pre-signed URL** | ✅ Yes              | ✅ Yes                      | ✅ Yes (temporarily) | ✅ Yes         |
| **Plain S3 URL**   | ❌ No               | ❌ No (unless public)       | ⚠️ Only if public   | ❌ No          |

---

## 🛠 TL;DR:

* First URL: **Signed**, temporary, authenticated → ✅ **works**
* Second URL: **Unsigned**, direct access → ❌ **fails** (object is private)

Let me know if you want to make your object public or auto-generate these URLs using Node.js.
